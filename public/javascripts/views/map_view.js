((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};App.Views.MapView=function(b){function d(){return this.toggleDirectionsLayer=a(this.toggleDirectionsLayer,this),this.toggleWeatherLayer=a(this.toggleWeatherLayer,this),this.toggleTrafficLayer=a(this.toggleTrafficLayer,this),this.toggleOverlays=a(this.toggleOverlays,this),this.toggleLayer=a(this.toggleLayer,this),this.setupDirections=a(this.setupDirections,this),this.setupPlaces=a(this.setupPlaces,this),this.renderMap=a(this.renderMap,this),this.render=a(this.render,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.name="MapView",d.prototype.template=JST["templates/map"],d.prototype.className="map",d.prototype.initialize=function(a){return this.gmaps=a.model,this.user=a.user,this.userLocation=this.user.getLocationAsLatLng(),this.destination=this.user.get("destination"),this.markersArray=[],d.__super__.initialize.apply(this,arguments)},d.prototype.render=function(){return this.$el.html(this.template()),this.renderMap(),this},d.prototype.renderMap=function(){var a,b=this;return a={zoom:this.gmaps.zoom,mapTypeId:this.gmaps.mapTypeId,center:this.userLocation},this.map=new google.maps.Map($("#map_canvas")[0],a),this.trafficLayer=new google.maps.TrafficLayer,this.toggleLayer(this.trafficLayer),this.weatherLayer=new google.maps.weather.WeatherLayer({temperatureUnits:google.maps.weather.TemperatureUnit.CELCIUS}),this.toggleLayer(this.weatherLayer),this.setupPlaces(),google.maps.event.addListener(this.map,"bounds_changed",function(a){if((new Date).getTime()-b.lastRequest.getTime()>200)return b.setupPlaces()}),this.destination!=null&&this.setupDirections(),$("[data-toggle=button]").button("toggle")},d.prototype.setupPlaces=function(){var a,b=this;if(this.map.getZoom()<10)return;if(!this.markersArray[0]||this.markersArray[0].getMap()!=null)return this.lastRequest=new Date,a={location:this.map.getCenter(),radius:this.gmaps.placeRadius,types:this.gmaps.placeTypes},this.placesLayer=new google.maps.places.PlacesService(this.map),this.placesLayer.search(a,function(a,c){var d,e,f,g,h;if(c===google.maps.places.PlacesServiceStatus.OK){h=[];for(f=0,g=a.length;f<g;f++)e=a[f],d=e,h.push(b.markersArray.push(new google.maps.Marker({position:e.geometry.location,map:b.map,title:e.name,icon:"/img/gas_station.png"})));return h}});return},d.prototype.setupDirections=function(){var a,b=this;return this.directionsLayer=new google.maps.DirectionsRenderer,this.directionsLayer.setMap(this.map),this.directionsLayer.setPanel($("#directions_panel")[0]),a={origin:this.userLocation,destination:this.destination,travelMode:this.gmaps.travelMode,unitSystem:this.gmaps.unitSystem},this.gmaps.requestDirections(a,function(a,c){return b.directionsLayer.setDirections(a)})},d.prototype.toggleLayer=function(a){return a.setMap(a.getMap()!=null?null:this.map)},d.prototype.toggleOverlays=function(){var a,b,c,d,e;d=this.markersArray,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.setMap(a.getMap()!=null?null:this.map));return e},d.prototype.toggleTrafficLayer=function(){return this.toggleLayer(this.trafficLayer)},d.prototype.toggleWeatherLayer=function(){return this.toggleLayer(this.weatherLayer)},d.prototype.toggleDirectionsLayer=function(){return this.toggleLayer(this.directionsLayer)},d.prototype.events={"click .toggle-traffic":"toggleTrafficLayer","click .toggle-conditions":"toggleWeatherLayer","click .toggle-directions":"toggleDirectionsLayer","click .toggle-places":"toggleOverlays"},d}(App.Views.Page)})).call(this)