((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};App.Views.MapView=function(b){function d(){return this.toggleWeatherLayer=a(this.toggleWeatherLayer,this),this.toggleTrafficLayer=a(this.toggleTrafficLayer,this),this.toggleOverlays=a(this.toggleOverlays,this),this.setupDirections=a(this.setupDirections,this),this.setupPlaces=a(this.setupPlaces,this),this.currentPositionCallback=a(this.currentPositionCallback,this),this.toggleLayer=a(this.toggleLayer,this),this.renderMap=a(this.renderMap,this),this.render=a(this.render,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.name="MapView",d.prototype.template=JST["templates/map"],d.prototype.className="map",d.prototype.initialize=function(a){var b;return b=JSON.parse(sessionStorage.getItem("userLocation")),this.userLocation=new google.maps.LatLng(b.latitude,b.longitude),this.userDestination=sessionStorage.getItem("userDestination"),d.__super__.initialize.apply(this,arguments)},d.prototype.render=function(){return this.$el.html(this.template()),this.renderMap(),this},d.prototype.renderMap=function(){var a;return a={zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,center:this.userLocation},this.map=new google.maps.Map($("#map_canvas")[0],a),this.trafficLayer=new google.maps.TrafficLayer,this.toggleLayer(this.trafficLayer),this.weatherLayer=new google.maps.weather.WeatherLayer({temperatureUnits:google.maps.weather.TemperatureUnit.CELCIUS}),this.toggleLayer(this.weatherLayer),this.setupPlaces(),this.userDestination!=null&&this.setupDirections(),$(".toggle-traffic, .toggle-conditions, .toggle-places").button("toggle")},d.prototype.toggleLayer=function(a){return a.setMap(a.getMap()!=null?null:this.map)},d.prototype.currentPositionCallback=function(a){},d.prototype.setupPlaces=function(){var a,b=this;return a={location:this.userLocation,radius:"5000",types:["gas_station"]},this.placesLayer=new google.maps.places.PlacesService(this.map),this.placesLayer.search(a,function(a,c){var d,e,f,g,h;if(c===google.maps.places.PlacesServiceStatus.OK){b.markersArray=[],h=[];for(f=0,g=a.length;f<g;f++)e=a[f],d=e,h.push(b.markersArray.push(new google.maps.Marker({position:e.geometry.location,map:b.map,title:e.name,icon:"/img/gas_station.png"})));return h}return console.log(c)})},d.prototype.setupDirections=function(){var a,b,c;return a=new google.maps.DirectionsRenderer,a.setMap(this.map),a.setPanel(document.getElementById("directionsPanel")),b=new google.maps.DirectionsService,c={origin:this.userLocation,destination:this.userDestination,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.METRIC},b.route(c,function(b,c){return c===google.maps.DirectionsStatus.OK?a.setDirections(b):alert("Error: "+c)})},d.prototype.toggleOverlays=function(){var a,b,c,d,e;d=this.markersArray,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.setMap(a.getMap()!=null?null:this.map));return e},d.prototype.toggleTrafficLayer=function(){return this.toggleLayer(this.trafficLayer)},d.prototype.toggleWeatherLayer=function(){return this.toggleLayer(this.weatherLayer)},d.prototype.events={"click .toggle-traffic":"toggleTrafficLayer","click .toggle-conditions":"toggleWeatherLayer","click .toggle-places":"toggleOverlays"},d}(App.Views.Page)})).call(this)