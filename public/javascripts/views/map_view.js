((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};App.Views.MapView=function(b){function e(){return this.toggleDirectionsLayer=a(this.toggleDirectionsLayer,this),this.toggleWeatherLayer=a(this.toggleWeatherLayer,this),this.toggleTrafficLayer=a(this.toggleTrafficLayer,this),this.toggleOverlays=a(this.toggleOverlays,this),this.toggleLayer=a(this.toggleLayer,this),this.setupDirections=a(this.setupDirections,this),this.loadPlaces=a(this.loadPlaces,this),this.renderMap=a(this.renderMap,this),this.render=a(this.render,this),e.__super__.constructor.apply(this,arguments)}return c(e,b),e.name="MapView",e.prototype.template=JST["templates/map"],e.prototype.className="map",e.prototype.initialize=function(a){return this.gmaps=a.model,this.user=a.user,this.userLocation=this.user.getLocationAsLatLng(),this.destination=this.user.get("destination"),this.markersArray=[],e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){return this.$el.html(this.template()),this.renderMap(),this},e.prototype.renderMap=function(){var a;return a={zoom:this.gmaps.zoom,mapTypeId:this.gmaps.mapTypeId,center:this.userLocation},this.map=new google.maps.Map($("#map_canvas")[0],a),this.trafficLayer=new google.maps.TrafficLayer,this.toggleLayer(this.trafficLayer),this.weatherLayer=new google.maps.weather.WeatherLayer({temperatureUnits:google.maps.weather.TemperatureUnit.CELCIUS}),this.toggleLayer(this.weatherLayer),this.loadPlaces(),this.destination!=null&&this.setupDirections(),$("[data-toggle=button]").button("toggle")},e.prototype.loadPlaces=function(){var a,b=this;setTimeout(function(){return b.loadPlaces()},500);if(this.map.getZoom()<10)return;if(!this.markersArray[0]||this.markersArray[0].getMap()!=null)return this.lastRequest=new Date,a={location:this.map.getCenter(),radius:this.gmaps.placeRadius,types:this.gmaps.placeTypes},this.placesLayer=new google.maps.places.PlacesService(this.map),this.placesLayer.search(a,function(a,c){var e,f,g,h,i,j;h=[];if(c===google.maps.places.PlacesServiceStatus.OK)for(i=0,j=a.length;i<j;i++)g=a[i],d.call(g.types,"lodging")>=0?e="/img/hotel.png":d.call(g.types,"car_repair")>=0?e="/img/car_repair.png":e="/img/gas_station.png",f=new google.maps.Marker({position:g.geometry.location,map:b.map,title:g.name,id:g.id,icon:e}),h.push(f);return b.markersArray=_.union(b.markersArray,h)});return},e.prototype.setupDirections=function(){var a,b=this;return this.directionsLayer=new google.maps.DirectionsRenderer,this.directionsLayer.setMap(this.map),this.directionsLayer.setPanel($("#directions_panel")[0]),a={origin:this.userLocation,destination:this.destination,travelMode:this.gmaps.travelMode,unitSystem:this.gmaps.unitSystem},this.gmaps.requestDirections(a,function(a,c){return b.directionsLayer.setDirections(a)})},e.prototype.toggleLayer=function(a){return a.setMap(a.getMap()!=null?null:this.map)},e.prototype.toggleOverlays=function(){var a,b,c,d,e;d=this.markersArray,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.setMap(a.getMap()!=null?null:this.map));return e},e.prototype.toggleTrafficLayer=function(){return this.toggleLayer(this.trafficLayer)},e.prototype.toggleWeatherLayer=function(){return this.toggleLayer(this.weatherLayer)},e.prototype.toggleDirectionsLayer=function(){return this.toggleLayer(this.directionsLayer)},e.prototype.events={"click .toggle-traffic":"toggleTrafficLayer","click .toggle-conditions":"toggleWeatherLayer","click .toggle-directions":"toggleDirectionsLayer","click .toggle-places":"toggleOverlays"},e}(App.Views.Page)})).call(this)